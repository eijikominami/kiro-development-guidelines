# プロジェクト構造ガイドライン

## ディレクトリ構造

### 基本構造
```
project-root/
├── .kiro/
│   ├── specs/
│   │   └── [project-name]/
│   │       ├── requirements.md
│   │       ├── design.md
│   │       └── tasks.md
│   └── steering/
│       ├── project-structure.md
│       ├── development-guidelines.md
│       ├── aws-architecture.md
│       ├── communication-guidelines.md
│       └── product-guidelines.md
└── [project-name]/
```

### プロジェクト構造の原則

#### 適用ルール
1. **機密情報の分離**: パブリックリポジトリとプライベート設定リポジトリを分離

#### SAMテンプレート配置ルール
- **親スタック**: `sam-app/template.yaml` に配置
- **子スタック**: `sam-app/[service-name].yaml` に配置
- **CFN Lint設定**: サービスルートに `.cfnlintrc` を配置
- **SAM設定**: プライベートリポジトリで `samconfig.toml` を管理

#### 例外事項
- `.kiro/specs/` - 仕様書は既存の構造を維持
- `.kiro/steering/` - ステアリングファイルは共通管理

## ファイル命名規則

### ドキュメント
- `requirements.md` - 要件定義
- `design.md` - 設計書
- `tasks.md` - 実装計画
- `README.md` - プロジェクト概要

### コード
- `app.py` - Lambda関数のメインファイル
- `template.yaml` - SAMテンプレート
- `requirements.txt` - Python依存関係

### スクリプト
- `deploy.sh` - デプロイスクリプト
- `setup-*.py` - セットアップスクリプト
- `validate.sh` - 検証スクリプト



## 仕様書管理

### .kiro/specs/ 構造
```
.kiro/specs/
└── [project-name]/
    ├── requirements.md  # 要件定義書
    ├── design.md       # 設計書
    └── tasks.md        # 実装計画書
```

### 仕様書の関係性
1. **requirements.md** → **design.md** → **tasks.md** の順で作成
2. 各ドキュメントは前段階の内容を参照
3. 変更時は関連ドキュメントも更新

## プロジェクトディレクトリ把握の必須ルール

### プロジェクト開始時の必須操作

**重要**: プロジェクトを開始する際には、プロジェクトファイルが置かれるディレクトリを把握する

#### 1. プロジェクトディレクトリの特定
- **現在の作業ディレクトリを確認**: `pwd`コマンドまたは`listDirectory`ツールで現在位置を把握
- **プロジェクトルートの特定**: `.kiro/specs/[project-name]/`から対応するプロジェクトディレクトリを特定
- **開いているファイル一覧の確認**: 複数プロジェクトのファイルが開いている場合、正しいプロジェクトを特定

#### 2. ファイル操作前の必須確認
- **対象ディレクトリの確認**: ファイル操作を行う前に、必ず正しいプロジェクトディレクトリ内のファイルかを確認
- **パスの明示的指定**: ファイル読み書き時は、プロジェクトディレクトリからの相対パスを明示的に指定
- **混同防止**: 類似名のプロジェクトやディレクトリがある場合は、特に注意深く確認

#### 3. 実行操作時の必須ルール
- **実行ディレクトリの指定**: `sam deploy`等のコマンド実行時は、必ず正しいプロジェクトディレクトリで実行
- **設定ファイルの確認**: `samconfig.toml`等の設定ファイルは、実行するプロジェクトディレクトリ内のものを使用
- **テンプレートファイルの確認**: デプロイ対象のテンプレートファイルが正しいプロジェクトのものかを確認

#### 4. エラー防止のチェックリスト
- [ ] 現在の作業プロジェクトを明確に把握している
- [ ] ファイル操作対象が正しいプロジェクトディレクトリ内である
- [ ] 実行コマンドが正しいプロジェクトディレクトリで実行される
- [ ] 設定ファイルが正しいプロジェクトのものである
- [ ] 類似名のプロジェクトと混同していない



## ステアリングファイル

### 目的
- 開発方針・ガイドラインの管理
- プロジェクト横断的なルールの定義
- 品質基準の統一

### ファイル構成
- `project-structure.md` - プロジェクト構造ガイドライン
- `development-guidelines.md` - 開発・技術ガイドライン
- `aws-architecture.md` - AWS固有のアーキテクチャガイドライン
- `communication-guidelines.md` - コミュニケーション・ドキュメント作成ガイドライン
- `product-guidelines.md` - プロダクト開発ガイドライン

### ステアリングファイルの管理原則
- **機能別分類**: 関連する内容を同一ファイルにまとめる
- **重複排除**: 同じ内容を複数ファイルに記載しない
- **参照関係**: 他ファイルの内容を参照する場合は明示的に記載
- **定期見直し**: プロジェクト進行に合わせて内容を更新

### ステアリングファイル追加時の自動再構成ルール

**重要**: ステアリングファイルを指示毎に作るのではなく、ステアリングの追加がなされたときそのたびに種類別に分類、再構成すること。

#### 自動再構成の手順
1. **新しいステアリング内容の分析**: 追加される内容がどの既存カテゴリに属するかを判断
2. **適切なファイルへの統合**: 既存の5つのファイル（development-guidelines.md、aws-architecture.md、communication-guidelines.md、project-structure.md、product-guidelines.md）のいずれかに統合
3. **重複内容の排除**: 既存内容との重複を確認し、必要に応じて統合・整理
4. **一貫性の確保**: 統合後のファイル全体の構成と内容の一貫性を確認
5. **不要ファイルの削除**: 個別に作成された指示毎のファイルは削除

#### 分類基準
- **development-guidelines.md**: 技術スタック、ビルドシステム、品質保証、開発プロセス
- **aws-architecture.md**: AWSサービス、CloudFormation、Lambda、セキュリティ、コスト管理
- **communication-guidelines.md**: 応答ルール、文書作成、クリーンアップ、レビュー
- **project-structure.md**: ディレクトリ構造、命名規則、仕様書管理、ファイル管理
- **product-guidelines.md**: UI/UX、データ管理、パフォーマンス、運用・保守

#### 例外処理
- 新しいカテゴリが必要な場合は、既存の5ファイル構成を見直し、必要に応じて再編成
- 複数カテゴリにまたがる内容は、最も関連性の高いファイルに配置し、他ファイルから参照

## セキュリティとプライバシー管理

### 機密情報分離の必須原則

**絶対ルール**: 設定ファイルや内部情報をパブリックに公開される可能性のあるコードと一緒に置かないこと

#### リポジトリ分離戦略
1. **パブリックリポジトリ**: テンプレート、サンプル、一般向けドキュメントのみ
2. **プライベート設定リポジトリ**: 実際の設定値、機密情報、内部手順
3. **AWS Secrets Manager**: 認証情報、APIキー等の機密データ

#### 設計書（design.md）への記載ルール

**必須記載事項**:
1. **プロジェクト構造セクション**: 詳細なディレクトリパスと役割
2. **リポジトリ構成**: パブリック・プライベートの分離方法
3. **設定ファイル管理**: 機密情報の取り扱い方法
4. **開発環境セットアップ**: 必要なツールと手順
5. **セキュリティ考慮事項**: 機密情報の適切な管理方法

#### 禁止事項と推奨事項

##### パブリックリポジトリで禁止
- ❌ 実際の設定値（Property ID、Account ID等）
- ❌ 認証情報（OAuth Client Secret、API Key等）
- ❌ 内部システムの具体的なパス
- ❌ プライベートリポジトリの場所
- ❌ 機密性の高い運用手順

##### プライベートリポジトリでのみ管理
- ✅ 実際のデプロイ設定（samconfig.toml）
- ✅ 機密情報（認証情報、APIキー）
- ✅ 内部向けデプロイ手順
- ✅ 環境固有の設定値
- ✅ デプロイ履歴とログ

##### SPECSでの記載推奨
- ✅ 詳細なプロジェクト構造
- ✅ 具体的なディレクトリパス
- ✅ 設定ファイルの管理方法
- ✅ セキュリティ考慮事項
- ✅ 開発環境セットアップ手順

#### 設定ファイル管理フロー

1. **開発時**: プライベートリポジトリから設定ファイルを取得
2. **デプロイ時**: 設定ファイルをパブリックリポジトリのワーキングディレクトリにコピー
3. **デプロイ後**: ワーキングディレクトリから設定ファイルを削除（.gitignoreで除外）
4. **バージョン管理**: 設定ファイルはプライベートリポジトリでのみ管理

#### チェックリスト

##### プロジェクト作成時
- [ ] パブリック・プライベートリポジトリの分離を確認
- [ ] .gitignoreに機密ファイルを追加
- [ ] 設定テンプレートファイルにプレースホルダーのみ記載
- [ ] design.mdにプロジェクト構造セクションを追加

##### デプロイ前
- [ ] 設定ファイルがプライベートリポジトリから取得されている
- [ ] パブリックリポジトリに機密情報が含まれていない
- [ ] .gitignoreが適切に設定されている
- [ ] 設定ファイルのパスが正しい

##### コードレビュー時
- [ ] 機密情報がコミットされていない
- [ ] 設定ファイルがプライベートリポジトリで管理されている
- [ ] ドキュメントに内部情報が記載されていない
- [ ] セキュリティガイドラインに準拠している